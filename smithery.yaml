build:
  dockerfile: Dockerfile
  dockerBuildPath: .

startCommand:
  type: stdio
  configSchema:
    type: object
    properties:
      logLevel:
        type: string
        description: "日志级别设置 (DEBUG, INFO, WARNING, ERROR)"
        enum: ["DEBUG", "INFO", "WARNING", "ERROR"]
        default: "INFO"
      tempStoragePath:
        type: string
        description: "临时文件存储路径"
        default: "/tmp/mcp-rquest"
      maxResponseSize:
        type: integer
        description: "最大响应大小（字节）"
        default: 10485760  # 10MB
    additionalProperties: false

  commandFunction: |
    (config) => ({
      command: 'python',
      args: ['-m', 'mcp_rquest'],
      env: {
        PYTHONUNBUFFERED: '1',
        PYTHONDONTWRITEBYTECODE: '1',
        LOG_LEVEL: config.logLevel || 'INFO',
        TEMP_STORAGE_PATH: config.tempStoragePath || '/tmp/mcp-rquest',
        MAX_RESPONSE_SIZE: String(config.maxResponseSize || 10485760)
      }
    })

# 测试配置
test:
  commands:
    - uv pip install -e ".[dev]"
    - python -m pytest

# 资源配置
resources:
  limits:
    memory: "1Gi"
    cpu: "1"
  requests:
    memory: "512Mi"
    cpu: "0.5"

# 健康检查
health:
  enabled: true
  path: /health
  port: 8080
  initialDelaySeconds: 10
  periodSeconds: 30
  timeoutSeconds: 5
  failureThreshold: 3

# 部署配置
deploy:
  replicas: 2
  strategy:
    type: RollingUpdate
    maxSurge: 1
    maxUnavailable: 0
